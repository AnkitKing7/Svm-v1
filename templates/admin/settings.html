{% extends "base.html" %}
{% block title %}Admin Settings - {{ settings.panel_name }}{% endblock %}
{% block content %}
<div class="main-container">
    <nav class="sidebar">
        <div class="sidebar-header">
            {% if settings.logo %}
            <img src="{{ settings.logo }}" alt="Logo" class="sidebar-logo">
            {% else %}
            <i class="fas fa-server sidebar-icon"></i>
            {% endif %}
            <h2>{{ settings.panel_name }}</h2>
        </div>

        <ul class="sidebar-menu">
            <li>
                <a href="{{ url_for('dashboard') }}">
                    <i class="fas fa-home"></i> User Dashboard
                </a>
            </li>
            <li>
                <a href="{{ url_for('admin_panel') }}">
                    <i class="fas fa-tachometer-alt"></i> Admin Dashboard
                </a>
            </li>
            <li>
                <a href="{{ url_for('admin_users') }}">
                    <i class="fas fa-users"></i> Manage Users
                </a>
            </li>
            <li>
                <a href="{{ url_for('admin_vps') }}">
                    <i class="fas fa-server"></i> Manage VPS
                </a>
            </li>
            <li>
                <a href="{{ url_for('admin_payments') }}">
                    <i class="fas fa-money-bill-wave"></i> Payments
                </a>
            </li>
            <li class="active">
                <a href="{{ url_for('admin_settings') }}">
                    <i class="fas fa-cog"></i> Settings
                </a>
            </li>
            <li>
                <a href="{{ url_for('logout') }}">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
            </li>
        </ul>
    </nav>

    <div class="main-content">
        <div class="top-bar">
            <div class="welcome-message">
                <h1><i class="fas fa-cog"></i> Panel Settings</h1>
                <p>Configure your VPS panel settings</p>
            </div>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                <div class="alert alert-{{ category }}">
                    {{ message }}
                </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Settings Tabs -->
        <div class="settings-tabs">
            <button class="settings-tab active" onclick="showTab('general')">
                <i class="fas fa-home"></i> General Settings
            </button>
            <button class="settings-tab" onclick="showTab('payment')">
                <i class="fas fa-credit-card"></i> Payment Settings
            </button>
            <button class="settings-tab" onclick="showTab('email')">
                <i class="fas fa-envelope"></i> Email Settings
            </button>
            <button class="settings-tab" onclick="showTab('appearance')">
                <i class="fas fa-palette"></i> Appearance
            </button>
        </div>

        <!-- General Settings -->
        <div id="general-tab" class="settings-section active">
            <div class="content-card">
                <div class="card-header">
                    <h2><i class="fas fa-home"></i> General Settings</h2>
                </div>
                <form method="POST" action="{{ url_for('admin_settings') }}" enctype="multipart/form-data">
                    <input type="hidden" name="section" value="general">
                    
                    <div class="form-group">
                        <label><i class="fas fa-tag"></i> Panel Name</label>
                        <input type="text" name="panel_name" value="{{ settings.panel_name }}" required>
                        <small>The name of your VPS panel</small>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-info-circle"></i> Panel Description</label>
                        <textarea name="panel_description" rows="3">{{ settings.panel_description }}</textarea>
                        <small>Brief description of your service</small>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-envelope"></i> Admin Email</label>
                        <input type="email" name="admin_email" value="{{ settings.admin_email }}" required>
                        <small>Main contact email for the panel</small>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-globe"></i> Website URL</label>
                        <input type="url" name="website_url" value="{{ settings.website_url }}">
                        <small>Your website URL (optional)</small>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" name="maintenance_mode" {% if settings.maintenance_mode %}checked{% endif %}>
                            <i class="fas fa-wrench"></i> Maintenance Mode
                        </label>
                        <small>Enable to restrict access for maintenance</small>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Payment Settings -->
        <div id="payment-tab" class="settings-section">
            <div class="content-card">
                <div class="card-header">
                    <h2><i class="fas fa-credit-card"></i> Payment Gateway Settings</h2>
                </div>
                <form method="POST" action="{{ url_for('admin_settings') }}">
                    <input type="hidden" name="section" value="payment">
                    
                    <div class="form-group">
                        <label><i class="fas fa-dollar-sign"></i> Currency</label>
                        <select name="currency">
                            <option value="USD" {% if settings.currency == 'USD' %}selected{% endif %}>USD - US Dollar</option>
                            <option value="EUR" {% if settings.currency == 'EUR' %}selected{% endif %}>EUR - Euro</option>
                            <option value="GBP" {% if settings.currency == 'GBP' %}selected{% endif %}>GBP - British Pound</option>
                            <option value="INR" {% if settings.currency == 'INR' %}selected{% endif %}>INR - Indian Rupee</option>
                        </select>
                    </div>

                    <div class="payment-method-section">
                        <h3><i class="fas fa-credit-card"></i> PayPal</h3>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" name="paypal_enabled" {% if settings.paypal_enabled %}checked{% endif %}>
                                Enable PayPal
                            </label>
                        </div>
                        <div class="form-group">
                            <label>PayPal Client ID</label>
                            <input type="text" name="paypal_client_id" value="{{ settings.paypal_client_id }}">
                        </div>
                        <div class="form-group">
                            <label>PayPal Secret</label>
                            <input type="password" name="paypal_secret" value="{{ settings.paypal_secret }}">
                        </div>
                    </div>

                    <div class="payment-method-section">
                        <h3><i class="fas fa-stripe"></i> Stripe</h3>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" name="stripe_enabled" {% if settings.stripe_enabled %}checked{% endif %}>
                                Enable Stripe
                            </label>
                        </div>
                        <div class="form-group">
                            <label>Stripe Publishable Key</label>
                            <input type="text" name="stripe_public_key" value="{{ settings.stripe_public_key }}">
                        </div>
                        <div class="form-group">
                            <label>Stripe Secret Key</label>
                            <input type="password" name="stripe_secret_key" value="{{ settings.stripe_secret_key }}">
                        </div>
                    </div>

                    <div class="payment-method-section">
                        <h3><i class="fas fa-money-bill"></i> Manual Payment</h3>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" name="manual_payment_enabled" {% if settings.manual_payment_enabled %}checked{% endif %}>
                                Enable Manual Payment (Bank Transfer, etc.)
                            </label>
                        </div>
                        <div class="form-group">
                            <label>Payment Instructions</label>
                            <textarea name="manual_payment_instructions" rows="5">{{ settings.manual_payment_instructions }}</textarea>
                            <small>Instructions for manual payment (bank details, etc.)</small>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Save Payment Settings
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Email Settings -->
        <div id="email-tab" class="settings-section">
            <div class="content-card">
                <div class="card-header">
                    <h2><i class="fas fa-envelope"></i> Email Configuration</h2>
                </div>
                <form method="POST" action="{{ url_for('admin_settings') }}">
                    <input type="hidden" name="section" value="email">
                    
                    <div class="form-group">
                        <label><i class="fas fa-server"></i> SMTP Host</label>
                        <input type="text" name="smtp_host" value="{{ settings.smtp_host }}">
                        <small>e.g., smtp.gmail.com</small>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-network-wired"></i> SMTP Port</label>
                        <input type="number" name="smtp_port" value="{{ settings.smtp_port }}">
                        <small>Common: 587 (TLS), 465 (SSL), 25 (standard)</small>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-user"></i> SMTP Username</label>
                        <input type="text" name="smtp_username" value="{{ settings.smtp_username }}">
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-lock"></i> SMTP Password</label>
                        <input type="password" name="smtp_password" value="{{ settings.smtp_password }}">
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-envelope"></i> From Email</label>
                        <input type="email" name="email_from" value="{{ settings.email_from }}">
                        <small>Email address to send from</small>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" name="smtp_tls" {% if settings.smtp_tls %}checked{% endif %}>
                            <i class="fas fa-shield-alt"></i> Use TLS
                        </label>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="testEmail()">
                            <i class="fas fa-paper-plane"></i> Send Test Email
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Save Email Settings
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Appearance Settings -->
        <div id="appearance-tab" class="settings-section">
            <div class="content-card">
                <div class="card-header">
                    <h2><i class="fas fa-palette"></i> Appearance Settings</h2>
                </div>
                <form method="POST" action="{{ url_for('admin_settings') }}" enctype="multipart/form-data">
                    <input type="hidden" name="section" value="appearance">
                    
                    <div class="form-group">
                        <label><i class="fas fa-image"></i> Panel Logo</label>
                        <input type="file" name="logo" accept="image/*">
                        {% if settings.logo %}
                        <div class="current-logo">
                            <img src="{{ settings.logo }}" alt="Current Logo">
                            <small>Current logo</small>
                        </div>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-image"></i> Background Image</label>
                        <input type="file" name="background" accept="image/*">
                        {% if settings.background %}
                        <div class="current-background">
                            <img src="{{ settings.background }}" alt="Current Background">
                            <small>Current background (displayed with opacity)</small>
                        </div>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-paint-brush"></i> Primary Color</label>
                        <input type="color" name="primary_color" value="{{ settings.primary_color or '#3498db' }}">
                        <small>Main accent color for the panel</small>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-moon"></i> Default Theme</label>
                        <select name="default_theme">
                            <option value="dark" {% if settings.default_theme == 'dark' %}selected{% endif %}>Dark Theme</option>
                            <option value="light" {% if settings.default_theme == 'light' %}selected{% endif %}>Light Theme</option>
                        </select>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Save Appearance
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<style>
.settings-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 30px;
    flex-wrap: wrap;
}

.settings-tab {
    padding: 15px 25px;
    border: 1px solid var(--border-color);
    background: var(--bg-secondary);
    color: var(--text-primary);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 14px;
}

.settings-tab:hover {
    background: var(--accent-blue);
    color: white;
    transform: translateY(-2px);
}

.settings-tab.active {
    background: var(--accent-blue);
    color: white;
    border-color: var(--accent-blue);
}

.settings-section {
    display: none;
}

.settings-section.active {
    display: block;
}

.form-group {
    margin-bottom: 25px;
}

.form-group label {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 8px;
    color: var(--text-primary);
    font-weight: 500;
}

.form-group input[type="text"],
.form-group input[type="email"],
.form-group input[type="password"],
.form-group input[type="url"],
.form-group input[type="number"],
.form-group textarea,
.form-group select {
    width: 100%;
    padding: 12px;
    border: 1px solid var(--border-color);
    border-radius: 5px;
    background: var(--bg-primary);
    color: var(--text-primary);
    font-size: 14px;
}

.form-group input[type="color"] {
    width: 100px;
    height: 40px;
    border: 1px solid var(--border-color);
    border-radius: 5px;
    cursor: pointer;
}

.form-group input[type="file"] {
    padding: 10px;
}

.form-group small {
    display: block;
    margin-top: 5px;
    color: var(--text-secondary);
    font-size: 12px;
}

.form-group textarea {
    min-height: 100px;
    resize: vertical;
}

.form-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid var(--border-color);
}

.payment-method-section {
    background: var(--bg-primary);
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 25px;
    border: 1px solid var(--border-color);
}

.payment-method-section h3 {
    margin-top: 0;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
    color: var(--text-primary);
}

.current-logo,
.current-background {
    margin-top: 15px;
    padding: 15px;
    background: var(--bg-primary);
    border-radius: 8px;
    border: 1px solid var(--border-color);
}

.current-logo img {
    max-width: 200px;
    max-height: 100px;
    display: block;
    margin-bottom: 10px;
}

.current-background img {
    max-width: 300px;
    max-height: 150px;
    display: block;
    margin-bottom: 10px;
    border-radius: 5px;
}

.alert {
    padding: 15px 20px;
    border-radius: 8px;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.alert-success {
    background: rgba(39, 174, 96, 0.2);
    color: #27ae60;
    border: 1px solid rgba(39, 174, 96, 0.3);
}

.alert-error {
    background: rgba(231, 76, 60, 0.2);
    color: #e74c3c;
    border: 1px solid rgba(231, 76, 60, 0.3);
}

.alert-info {
    background: rgba(52, 152, 219, 0.2);
    color: #3498db;
    border: 1px solid rgba(52, 152, 219, 0.3);
}
</style>

<script>
function showTab(tabName) {
    // Hide all sections
    document.querySelectorAll('.settings-section').forEach(section => {
        section.classList.remove('active');
    });
    
    // Remove active class from all tabs
    document.querySelectorAll('.settings-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Show selected section
    document.getElementById(tabName + '-tab').classList.add('active');
    
    // Add active class to clicked tab
    event.target.closest('.settings-tab').classList.add('active');
}

function testEmail() {
    const email = prompt('Enter email address to send test email:');
    if (email) {
        fetch('/admin/settings/test-email', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email: email })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Test email sent successfully!');
            } else {
                alert('Failed to send test email: ' + data.message);
            }
        })
        .catch(error => {
            alert('Error: ' + error);
        });
    }
}
</script>
{% endblock %}
